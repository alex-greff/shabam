# FROM trzeci/emscripten:1.39.4-ubuntu

# WORKDIR /

# # Install required packages
# RUN apt-get update && \ 
#     apt-get install -y bash

# # Install the client    
# WORKDIR /app

# COPY ./package*.json ./

# # Install npm dependencies
# RUN npm install

# # Install gulp cli
# # RUN npm install gulp-cli -g

# # Copy all the client files
# COPY . .

# # Start dev server
# CMD ["npm", "run", "start:dev"]








# FROM trzeci/emscripten:sdk-tag-1.39.4-64bit as emscripten_base

# # FROM ubuntu:16.04
# FROM node:14.2-alpine

# # Copy pre-compiled content of Emscripten SDK to target iamge
# COPY --from=emscripten_base /emsdk_portable /emsdk_portable

# WORKDIR /

# # Install required packages
# RUN apk update --no-cache && \
#     apk add --no-cache \
#         bash git make g++ \
#         python py-pip ca-certificates

# # Install the client    
# WORKDIR /app

# COPY ./package*.json ./

# # Install npm dependencies
# RUN npm install

# # Install gulp cli
# RUN npm install gulp-cli -g

# # Copy all the client files
# COPY . .

# # Setup Emscripten Environment variables
# ENV EMSDK /emsdk_portable
# ENV EMSCRIPTEN=${EMSDK}/emscripten/sdk

# ENV EM_DATA ${EMSDK}/.data
# ENV EM_CONFIG ${EMSDK}/.emscripten
# ENV EM_CACHE ${EM_DATA}/cache
# ENV EM_PORTS ${EM_DATA}/ports

# # Expose tools to system PATH
# ENV PATH="${EMSDK}:${EMSDK}/emscripten/sdk:${EMSDK}/llvm/clang/bin:${EMSDK}/node/current/bin:${EMSDK}/binaryen/bin:${PATH}"

# # Start dev server
# CMD ["npm", "run", "start:dev"]



FROM trzeci/emscripten:sdk-tag-1.39.4-64bit as emscripten_base

FROM ubuntu:16.04

# Copy pre-compiled content of Emscripten SDK to target iamge
COPY --from=emscripten_base /emsdk_portable /emsdk_portable

# Setup Emscripten Environment variables
ENV EMSDK /emsdk_portable
ENV EMSCRIPTEN=${EMSDK}/emscripten/sdk

ENV EM_DATA ${EMSDK}/.data
ENV EM_CONFIG ${EMSDK}/.emscripten
ENV EM_CACHE ${EM_DATA}/cache
ENV EM_PORTS ${EM_DATA}/ports

# Expose tools to system PATH
# ENV PATH="${EMSDK}:${EMSDK}/emscripten/sdk:${EMSDK}/llvm/clang/bin:${EMSDK}/node/current/bin:${EMSDK}/binaryen/bin:${PATH}"
ENV PATH="${EMSDK}:${EMSDK}/emscripten/sdk:${EMSDK}/llvm/clang/bin:${EMSDK}/binaryen/bin:${PATH}"

WORKDIR /

# Install apt-add-repository
RUN apt-get update && \
    apt-get install -y software-properties-common

# Install required packages
RUN add-apt-repository ppa:ubuntu-toolchain-r/test && \
    apt-get update && \
    apt-get install -y bash curl git build-essential libstdc++6 python python-pip ca-certificates && \
    apt-get upgrade -y libstdc++6 && \
    curl -sL https://deb.nodesource.com/setup_14.x | bash - && \
    apt-get install -y nodejs
# RUN apk update --no-cache && \
#     apk add --no-cache \
#         bash git make g++ \
#         python py-pip ca-certificates

# Install the client    
WORKDIR /app

COPY ./package*.json ./

# Install npm dependencies
RUN npm install

# Install gulp cli
RUN npm install gulp-cli -g

# Copy all the client files
COPY . .

# Start dev server
CMD ["npm", "run", "start:dev"]